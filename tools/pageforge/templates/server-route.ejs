/**
* Server routes for <%= spec.title %>
    * Auto-generated by PageForge
    */

    const express = require('express');
    const { z } = require('zod');
    const { db } = require('../db');
    const { requireAuth } = require('../auth');
    const { roundTo5Paise } = require('../utils/formatting');

    // Helper functions
    function camelCase(str) {
    return str.replace(/(?:^\w|[A-Z]|\b\w)/g, (word, index) => {
    return index === 0 ? word.toLowerCase() : word.toUpperCase();
    }).replace(/\s+/g, '');
    }

    function kebabCase(str) {
    return str.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();
    }

    function pluralize(str) {
    if (str.endsWith('ch') || str.endsWith('sh') || str.endsWith('x') || str.endsWith('z')) {
    return str + 'es';
    } else if (str.endsWith('y') && !str.match(/[aeiou]y$/)) {
    return str.slice(0, -1) + 'ies';
    } else if (str.endsWith('f')) {
    return str.slice(0, -1) + 'ves';
    } else if (str.endsWith('fe')) {
    return str.slice(0, -2) + 'ves';
    } else {
    return str + 's';
    }
    }

    function pascalCase(str) {
    return str.charAt(0).toUpperCase() + str.slice(1);
    }

    function getZodType(field) {
    const typeMap = {
    'string': 'z.string()',
    'number': 'z.number()',
    'boolean': 'z.boolean()',
    'datetime': 'z.string().datetime()',
    'time': 'z.string()',
    'date': 'z.string().date()',
    'money': 'z.number().positive()',
    'enum': field.values ? `z.enum([${field.values.map(v => `'${v.replace(/'/g, "\\'")}'`).join(', ')}])` :
    'z.string()',
    'array<string>': 'z.array(z.string())'
        };
        return typeMap[field.type] || 'z.any()';
        }

        function getBodyValidation(endpoint) {
        if (!endpoint.body) return 'z.object({})';
        return 'z.object({})'; // Simplified for now
        }

        function getQueryValidation(endpoint) {
        if (!endpoint.query) return 'z.object({})';
        return 'z.object({})'; // Simplified for now
        }

        const router = express.Router();

        // Validation schemas
        <% if (spec.entities && spec.entities.length> 0) { %>
            <% spec.entities.forEach(entity=> { %>
                const <%= camelCase(entity.name) %>Schema = z.object({
                    <% entity.fields.forEach(field=> { %>
                        <% if (field.required) { %>
                            <%= field.key %>: <%= getZodType(field) %>,
                                    <% } else { %>
                                        <%= field.key %>: <%= getZodType(field) %>.optional(),
                                                <% } %>
                                                    <% }); %>
                                                        });

                                                        const create<%= pascalCase(entity.name) %>Schema = z.object({
                                                            <% entity.fields.forEach(field=> { %>
                                                                <% if (field.required) { %>
                                                                    <%= field.key %>: <%= getZodType(field) %>,
                                                                            <% } else { %>
                                                                                <%= field.key %>: <%= getZodType(field)
                                                                                        %>.optional(),
                                                                                        <% } %>
                                                                                            <% }); %>
                                                                                                });

                                                                                                const update<%=
                                                                                                    pascalCase(entity.name)
                                                                                                    %>Schema = create<%=
                                                                                                        pascalCase(entity.name)
                                                                                                        %>
                                                                                                        Schema.partial().extend({
                                                                                                        id:
                                                                                                        z.string().uuid()
                                                                                                        });
                                                                                                        <% }); %>
                                                                                                            <% } else {
                                                                                                                %>
                                                                                                                // No
                                                                                                                entities
                                                                                                                defined
                                                                                                                - using
                                                                                                                basic
                                                                                                                schemas
                                                                                                                const
                                                                                                                itemSchema
                                                                                                                =
                                                                                                                z.object({
                                                                                                                id:
                                                                                                                z.string().uuid(),
                                                                                                                createdAt:
                                                                                                                z.string().datetime(),
                                                                                                                updatedAt:
                                                                                                                z.string().datetime()
                                                                                                                });

                                                                                                                const
                                                                                                                createItemSchema
                                                                                                                =
                                                                                                                z.object({
                                                                                                                // Add
                                                                                                                fields
                                                                                                                as
                                                                                                                needed
                                                                                                                });

                                                                                                                const
                                                                                                                updateItemSchema
                                                                                                                =
                                                                                                                createItemSchema.partial().extend({
                                                                                                                id:
                                                                                                                z.string().uuid()
                                                                                                                });
                                                                                                                <% } %>

                                                                                                                    //
                                                                                                                    Health
                                                                                                                    check
                                                                                                                    router.get('/health',
                                                                                                                    (req,
                                                                                                                    res)
                                                                                                                    => {
                                                                                                                    res.json({
                                                                                                                    ok:
                                                                                                                    true,
                                                                                                                    service:
                                                                                                                    '<%= kebabCase(spec.id)
                                                                                                                        %>
                                                                                                                        ',
                                                                                                                        timestamp:
                                                                                                                        new
                                                                                                                        Date().toISOString()
                                                                                                                        });
                                                                                                                        });

                                                                                                                        <% if
                                                                                                                            (spec.api
                                                                                                                            &&
                                                                                                                            spec.api.endpoints)
                                                                                                                            {
                                                                                                                            %>
                                                                                                                            <%
                                                                                                                                spec.api.endpoints.forEach(endpoint=>
                                                                                                                                {
                                                                                                                                %>
                                                                                                                                //
                                                                                                                                <%= endpoint.method
                                                                                                                                    %>
                                                                                                                                    <%= endpoint.path
                                                                                                                                        %>
                                                                                                                                        router.
                                                                                                                                        <%= endpoint.method.toLowerCase()
                                                                                                                                            %>
                                                                                                                                            ('
                                                                                                                                            <%= endpoint.path
                                                                                                                                                %>
                                                                                                                                                ',
                                                                                                                                                <% if
                                                                                                                                                    (endpoint.auth)
                                                                                                                                                    {
                                                                                                                                                    %>
                                                                                                                                                    requireAuth,
                                                                                                                                                    <% }
                                                                                                                                                        %>
                                                                                                                                                        async
                                                                                                                                                        (req,
                                                                                                                                                        res)
                                                                                                                                                        =>
                                                                                                                                                        {
                                                                                                                                                        try
                                                                                                                                                        {
                                                                                                                                                        <% if
                                                                                                                                                            (endpoint.body)
                                                                                                                                                            {
                                                                                                                                                            %>
                                                                                                                                                            const
                                                                                                                                                            body
                                                                                                                                                            =
                                                                                                                                                            <%= getBodyValidation(endpoint)
                                                                                                                                                                %>
                                                                                                                                                                .parse(req.body);
                                                                                                                                                                <% }
                                                                                                                                                                    %>
                                                                                                                                                                    <% if
                                                                                                                                                                        (endpoint.query)
                                                                                                                                                                        {
                                                                                                                                                                        %>
                                                                                                                                                                        const
                                                                                                                                                                        query
                                                                                                                                                                        =
                                                                                                                                                                        <%= getQueryValidation(endpoint)
                                                                                                                                                                            %>
                                                                                                                                                                            .parse(req.query);
                                                                                                                                                                            <% }
                                                                                                                                                                                %>

                                                                                                                                                                                <% if
                                                                                                                                                                                    (endpoint.method==='GET'
                                                                                                                                                                                    )
                                                                                                                                                                                    {
                                                                                                                                                                                    %>
                                                                                                                                                                                    //
                                                                                                                                                                                    GET
                                                                                                                                                                                    implementation
                                                                                                                                                                                    <% if
                                                                                                                                                                                        (spec.entities
                                                                                                                                                                                        &&
                                                                                                                                                                                        spec.entities[0])
                                                                                                                                                                                        {
                                                                                                                                                                                        %>
                                                                                                                                                                                        const
                                                                                                                                                                                        data
                                                                                                                                                                                        =
                                                                                                                                                                                        await
                                                                                                                                                                                        get
                                                                                                                                                                                        <%= pascalCase(spec.entities[0].name)
                                                                                                                                                                                            %>
                                                                                                                                                                                            List(
                                                                                                                                                                                            <% if
                                                                                                                                                                                                (endpoint.query)
                                                                                                                                                                                                {
                                                                                                                                                                                                %>
                                                                                                                                                                                                query
                                                                                                                                                                                                <% }
                                                                                                                                                                                                    %>
                                                                                                                                                                                                    );
                                                                                                                                                                                                    <% } else
                                                                                                                                                                                                        {
                                                                                                                                                                                                        %>
                                                                                                                                                                                                        const
                                                                                                                                                                                                        data
                                                                                                                                                                                                        =
                                                                                                                                                                                                        await
                                                                                                                                                                                                        getItemList(
                                                                                                                                                                                                        <% if
                                                                                                                                                                                                            (endpoint.query)
                                                                                                                                                                                                            {
                                                                                                                                                                                                            %>
                                                                                                                                                                                                            query
                                                                                                                                                                                                            <% }
                                                                                                                                                                                                                %>
                                                                                                                                                                                                                );
                                                                                                                                                                                                                <% }
                                                                                                                                                                                                                    %>
                                                                                                                                                                                                                    res.json({
                                                                                                                                                                                                                    ok:
                                                                                                                                                                                                                    true,
                                                                                                                                                                                                                    data
                                                                                                                                                                                                                    });
                                                                                                                                                                                                                    <% } else
                                                                                                                                                                                                                        if
                                                                                                                                                                                                                        (endpoint.method==='POST'
                                                                                                                                                                                                                        )
                                                                                                                                                                                                                        {
                                                                                                                                                                                                                        %>
                                                                                                                                                                                                                        //
                                                                                                                                                                                                                        POST
                                                                                                                                                                                                                        implementation
                                                                                                                                                                                                                        <% if
                                                                                                                                                                                                                            (spec.entities
                                                                                                                                                                                                                            &&
                                                                                                                                                                                                                            spec.entities[0])
                                                                                                                                                                                                                            {
                                                                                                                                                                                                                            %>
                                                                                                                                                                                                                            const
                                                                                                                                                                                                                            data
                                                                                                                                                                                                                            =
                                                                                                                                                                                                                            await
                                                                                                                                                                                                                            create
                                                                                                                                                                                                                            <%= pascalCase(spec.entities[0].name)
                                                                                                                                                                                                                                %>
                                                                                                                                                                                                                                (
                                                                                                                                                                                                                                <% if
                                                                                                                                                                                                                                    (endpoint.body)
                                                                                                                                                                                                                                    {
                                                                                                                                                                                                                                    %>
                                                                                                                                                                                                                                    body
                                                                                                                                                                                                                                    <% }
                                                                                                                                                                                                                                        %>
                                                                                                                                                                                                                                        );
                                                                                                                                                                                                                                        <% } else
                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                            %>
                                                                                                                                                                                                                                            const
                                                                                                                                                                                                                                            data
                                                                                                                                                                                                                                            =
                                                                                                                                                                                                                                            await
                                                                                                                                                                                                                                            createItem(
                                                                                                                                                                                                                                            <% if
                                                                                                                                                                                                                                                (endpoint.body)
                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                %>
                                                                                                                                                                                                                                                body
                                                                                                                                                                                                                                                <% }
                                                                                                                                                                                                                                                    %>
                                                                                                                                                                                                                                                    );
                                                                                                                                                                                                                                                    <% }
                                                                                                                                                                                                                                                        %>
                                                                                                                                                                                                                                                        res.json({
                                                                                                                                                                                                                                                        ok:
                                                                                                                                                                                                                                                        true,
                                                                                                                                                                                                                                                        data
                                                                                                                                                                                                                                                        });
                                                                                                                                                                                                                                                        <% } else
                                                                                                                                                                                                                                                            if
                                                                                                                                                                                                                                                            (endpoint.method==='PUT'
                                                                                                                                                                                                                                                            )
                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                            %>
                                                                                                                                                                                                                                                            //
                                                                                                                                                                                                                                                            PUT
                                                                                                                                                                                                                                                            implementation
                                                                                                                                                                                                                                                            <% if
                                                                                                                                                                                                                                                                (spec.entities
                                                                                                                                                                                                                                                                &&
                                                                                                                                                                                                                                                                spec.entities[0])
                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                %>
                                                                                                                                                                                                                                                                const
                                                                                                                                                                                                                                                                data
                                                                                                                                                                                                                                                                =
                                                                                                                                                                                                                                                                await
                                                                                                                                                                                                                                                                update
                                                                                                                                                                                                                                                                <%= pascalCase(spec.entities[0].name)
                                                                                                                                                                                                                                                                    %>
                                                                                                                                                                                                                                                                    (
                                                                                                                                                                                                                                                                    <% if
                                                                                                                                                                                                                                                                        (endpoint.body)
                                                                                                                                                                                                                                                                        {
                                                                                                                                                                                                                                                                        %>
                                                                                                                                                                                                                                                                        body
                                                                                                                                                                                                                                                                        <% }
                                                                                                                                                                                                                                                                            %>
                                                                                                                                                                                                                                                                            );
                                                                                                                                                                                                                                                                            <% } else
                                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                                %>
                                                                                                                                                                                                                                                                                const
                                                                                                                                                                                                                                                                                data
                                                                                                                                                                                                                                                                                =
                                                                                                                                                                                                                                                                                await
                                                                                                                                                                                                                                                                                updateItem(
                                                                                                                                                                                                                                                                                <% if
                                                                                                                                                                                                                                                                                    (endpoint.body)
                                                                                                                                                                                                                                                                                    {
                                                                                                                                                                                                                                                                                    %>
                                                                                                                                                                                                                                                                                    body
                                                                                                                                                                                                                                                                                    <% }
                                                                                                                                                                                                                                                                                        %>
                                                                                                                                                                                                                                                                                        );
                                                                                                                                                                                                                                                                                        <% }
                                                                                                                                                                                                                                                                                            %>
                                                                                                                                                                                                                                                                                            res.json({
                                                                                                                                                                                                                                                                                            ok:
                                                                                                                                                                                                                                                                                            true,
                                                                                                                                                                                                                                                                                            data
                                                                                                                                                                                                                                                                                            });
                                                                                                                                                                                                                                                                                            <% } else
                                                                                                                                                                                                                                                                                                if
                                                                                                                                                                                                                                                                                                (endpoint.method==='DELETE'
                                                                                                                                                                                                                                                                                                )
                                                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                                                %>
                                                                                                                                                                                                                                                                                                //
                                                                                                                                                                                                                                                                                                DELETE
                                                                                                                                                                                                                                                                                                implementation
                                                                                                                                                                                                                                                                                                <% if
                                                                                                                                                                                                                                                                                                    (spec.entities
                                                                                                                                                                                                                                                                                                    &&
                                                                                                                                                                                                                                                                                                    spec.entities[0])
                                                                                                                                                                                                                                                                                                    {
                                                                                                                                                                                                                                                                                                    %>
                                                                                                                                                                                                                                                                                                    await
                                                                                                                                                                                                                                                                                                    delete
                                                                                                                                                                                                                                                                                                    <%= pascalCase(spec.entities[0].name)
                                                                                                                                                                                                                                                                                                        %>
                                                                                                                                                                                                                                                                                                        (req.params.id);
                                                                                                                                                                                                                                                                                                        <% } else
                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                            %>
                                                                                                                                                                                                                                                                                                            await
                                                                                                                                                                                                                                                                                                            deleteItem(req.params.id);
                                                                                                                                                                                                                                                                                                            <% }
                                                                                                                                                                                                                                                                                                                %>
                                                                                                                                                                                                                                                                                                                res.json({
                                                                                                                                                                                                                                                                                                                ok:
                                                                                                                                                                                                                                                                                                                true
                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                <% }
                                                                                                                                                                                                                                                                                                                    %>

                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                    catch
                                                                                                                                                                                                                                                                                                                    (error)
                                                                                                                                                                                                                                                                                                                    {
                                                                                                                                                                                                                                                                                                                    console.error('
                                                                                                                                                                                                                                                                                                                    <%= spec.id
                                                                                                                                                                                                                                                                                                                        %>
                                                                                                                                                                                                                                                                                                                        error:',
                                                                                                                                                                                                                                                                                                                        error);

                                                                                                                                                                                                                                                                                                                        if
                                                                                                                                                                                                                                                                                                                        (error.name
                                                                                                                                                                                                                                                                                                                        ===
                                                                                                                                                                                                                                                                                                                        'ZodError')
                                                                                                                                                                                                                                                                                                                        {
                                                                                                                                                                                                                                                                                                                        return
                                                                                                                                                                                                                                                                                                                        res.status(400).json({
                                                                                                                                                                                                                                                                                                                        ok:
                                                                                                                                                                                                                                                                                                                        false,
                                                                                                                                                                                                                                                                                                                        error:
                                                                                                                                                                                                                                                                                                                        'Validation
                                                                                                                                                                                                                                                                                                                        error',
                                                                                                                                                                                                                                                                                                                        details:
                                                                                                                                                                                                                                                                                                                        error.errors
                                                                                                                                                                                                                                                                                                                        });
                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                        res.status(500).json({
                                                                                                                                                                                                                                                                                                                        ok:
                                                                                                                                                                                                                                                                                                                        false,
                                                                                                                                                                                                                                                                                                                        error:
                                                                                                                                                                                                                                                                                                                        'Internal
                                                                                                                                                                                                                                                                                                                        server
                                                                                                                                                                                                                                                                                                                        error'
                                                                                                                                                                                                                                                                                                                        });
                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                        });
                                                                                                                                                                                                                                                                                                                        <% });
                                                                                                                                                                                                                                                                                                                            %>
                                                                                                                                                                                                                                                                                                                            <% } else
                                                                                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                                                                                %>
                                                                                                                                                                                                                                                                                                                                //
                                                                                                                                                                                                                                                                                                                                No
                                                                                                                                                                                                                                                                                                                                API
                                                                                                                                                                                                                                                                                                                                endpoints
                                                                                                                                                                                                                                                                                                                                defined
                                                                                                                                                                                                                                                                                                                                -
                                                                                                                                                                                                                                                                                                                                basic
                                                                                                                                                                                                                                                                                                                                CRUD
                                                                                                                                                                                                                                                                                                                                routes
                                                                                                                                                                                                                                                                                                                                router.get('/list',
                                                                                                                                                                                                                                                                                                                                requireAuth,
                                                                                                                                                                                                                                                                                                                                async
                                                                                                                                                                                                                                                                                                                                (req,
                                                                                                                                                                                                                                                                                                                                res)
                                                                                                                                                                                                                                                                                                                                =>
                                                                                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                                                                                try
                                                                                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                                                                                const
                                                                                                                                                                                                                                                                                                                                data
                                                                                                                                                                                                                                                                                                                                =
                                                                                                                                                                                                                                                                                                                                await
                                                                                                                                                                                                                                                                                                                                getItemList();
                                                                                                                                                                                                                                                                                                                                res.json({
                                                                                                                                                                                                                                                                                                                                ok:
                                                                                                                                                                                                                                                                                                                                true,
                                                                                                                                                                                                                                                                                                                                data
                                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                catch
                                                                                                                                                                                                                                                                                                                                (error)
                                                                                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                                                                                res.status(500).json({
                                                                                                                                                                                                                                                                                                                                ok:
                                                                                                                                                                                                                                                                                                                                false,
                                                                                                                                                                                                                                                                                                                                error:
                                                                                                                                                                                                                                                                                                                                'Internal
                                                                                                                                                                                                                                                                                                                                server
                                                                                                                                                                                                                                                                                                                                error'
                                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                });

                                                                                                                                                                                                                                                                                                                                router.post('/',
                                                                                                                                                                                                                                                                                                                                requireAuth,
                                                                                                                                                                                                                                                                                                                                async
                                                                                                                                                                                                                                                                                                                                (req,
                                                                                                                                                                                                                                                                                                                                res)
                                                                                                                                                                                                                                                                                                                                =>
                                                                                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                                                                                try
                                                                                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                                                                                const
                                                                                                                                                                                                                                                                                                                                data
                                                                                                                                                                                                                                                                                                                                =
                                                                                                                                                                                                                                                                                                                                await
                                                                                                                                                                                                                                                                                                                                createItem(req.body);
                                                                                                                                                                                                                                                                                                                                res.json({
                                                                                                                                                                                                                                                                                                                                ok:
                                                                                                                                                                                                                                                                                                                                true,
                                                                                                                                                                                                                                                                                                                                data
                                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                catch
                                                                                                                                                                                                                                                                                                                                (error)
                                                                                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                                                                                res.status(500).json({
                                                                                                                                                                                                                                                                                                                                ok:
                                                                                                                                                                                                                                                                                                                                false,
                                                                                                                                                                                                                                                                                                                                error:
                                                                                                                                                                                                                                                                                                                                'Internal
                                                                                                                                                                                                                                                                                                                                server
                                                                                                                                                                                                                                                                                                                                error'
                                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                });

                                                                                                                                                                                                                                                                                                                                router.put('/:id',
                                                                                                                                                                                                                                                                                                                                requireAuth,
                                                                                                                                                                                                                                                                                                                                async
                                                                                                                                                                                                                                                                                                                                (req,
                                                                                                                                                                                                                                                                                                                                res)
                                                                                                                                                                                                                                                                                                                                =>
                                                                                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                                                                                try
                                                                                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                                                                                const
                                                                                                                                                                                                                                                                                                                                data
                                                                                                                                                                                                                                                                                                                                =
                                                                                                                                                                                                                                                                                                                                await
                                                                                                                                                                                                                                                                                                                                updateItem({
                                                                                                                                                                                                                                                                                                                                ...req.body,
                                                                                                                                                                                                                                                                                                                                id:
                                                                                                                                                                                                                                                                                                                                req.params.id
                                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                                res.json({
                                                                                                                                                                                                                                                                                                                                ok:
                                                                                                                                                                                                                                                                                                                                true,
                                                                                                                                                                                                                                                                                                                                data
                                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                catch
                                                                                                                                                                                                                                                                                                                                (error)
                                                                                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                                                                                res.status(500).json({
                                                                                                                                                                                                                                                                                                                                ok:
                                                                                                                                                                                                                                                                                                                                false,
                                                                                                                                                                                                                                                                                                                                error:
                                                                                                                                                                                                                                                                                                                                'Internal
                                                                                                                                                                                                                                                                                                                                server
                                                                                                                                                                                                                                                                                                                                error'
                                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                });

                                                                                                                                                                                                                                                                                                                                router.delete('/:id',
                                                                                                                                                                                                                                                                                                                                requireAuth,
                                                                                                                                                                                                                                                                                                                                async
                                                                                                                                                                                                                                                                                                                                (req,
                                                                                                                                                                                                                                                                                                                                res)
                                                                                                                                                                                                                                                                                                                                =>
                                                                                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                                                                                try
                                                                                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                                                                                await
                                                                                                                                                                                                                                                                                                                                deleteItem(req.params.id);
                                                                                                                                                                                                                                                                                                                                res.json({
                                                                                                                                                                                                                                                                                                                                ok:
                                                                                                                                                                                                                                                                                                                                true
                                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                catch
                                                                                                                                                                                                                                                                                                                                (error)
                                                                                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                                                                                res.status(500).json({
                                                                                                                                                                                                                                                                                                                                ok:
                                                                                                                                                                                                                                                                                                                                false,
                                                                                                                                                                                                                                                                                                                                error:
                                                                                                                                                                                                                                                                                                                                'Internal
                                                                                                                                                                                                                                                                                                                                server
                                                                                                                                                                                                                                                                                                                                error'
                                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                                <% }
                                                                                                                                                                                                                                                                                                                                    %>

                                                                                                                                                                                                                                                                                                                                    //
                                                                                                                                                                                                                                                                                                                                    Database
                                                                                                                                                                                                                                                                                                                                    functions
                                                                                                                                                                                                                                                                                                                                    <% if
                                                                                                                                                                                                                                                                                                                                        (spec.entities
                                                                                                                                                                                                                                                                                                                                        &&
                                                                                                                                                                                                                                                                                                                                        spec.entities.length>
                                                                                                                                                                                                                                                                                                                                        0)
                                                                                                                                                                                                                                                                                                                                        {
                                                                                                                                                                                                                                                                                                                                        %>
                                                                                                                                                                                                                                                                                                                                        <%
                                                                                                                                                                                                                                                                                                                                            spec.entities.forEach(entity=>
                                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                            %>
                                                                                                                                                                                                                                                                                                                                            async
                                                                                                                                                                                                                                                                                                                                            function
                                                                                                                                                                                                                                                                                                                                            get
                                                                                                                                                                                                                                                                                                                                            <%= pascalCase(entity.name)
                                                                                                                                                                                                                                                                                                                                                %>
                                                                                                                                                                                                                                                                                                                                                List(
                                                                                                                                                                                                                                                                                                                                                <% if
                                                                                                                                                                                                                                                                                                                                                    (spec.api
                                                                                                                                                                                                                                                                                                                                                    &&
                                                                                                                                                                                                                                                                                                                                                    spec.api.endpoints
                                                                                                                                                                                                                                                                                                                                                    &&
                                                                                                                                                                                                                                                                                                                                                    spec.api.endpoints.some(e=>
                                                                                                                                                                                                                                                                                                                                                    e.method
                                                                                                                                                                                                                                                                                                                                                    ===
                                                                                                                                                                                                                                                                                                                                                    'GET'
                                                                                                                                                                                                                                                                                                                                                    &&
                                                                                                                                                                                                                                                                                                                                                    e.query))
                                                                                                                                                                                                                                                                                                                                                    {
                                                                                                                                                                                                                                                                                                                                                    %>query
                                                                                                                                                                                                                                                                                                                                                    =
                                                                                                                                                                                                                                                                                                                                                    {}
                                                                                                                                                                                                                                                                                                                                                    <% }
                                                                                                                                                                                                                                                                                                                                                        %>
                                                                                                                                                                                                                                                                                                                                                        )
                                                                                                                                                                                                                                                                                                                                                        {
                                                                                                                                                                                                                                                                                                                                                        const
                                                                                                                                                                                                                                                                                                                                                        sql
                                                                                                                                                                                                                                                                                                                                                        =
                                                                                                                                                                                                                                                                                                                                                        `
                                                                                                                                                                                                                                                                                                                                                        SELECT
                                                                                                                                                                                                                                                                                                                                                        *
                                                                                                                                                                                                                                                                                                                                                        FROM
                                                                                                                                                                                                                                                                                                                                                        <%= pluralize(kebabCase(entity.name))
                                                                                                                                                                                                                                                                                                                                                            %>
                                                                                                                                                                                                                                                                                                                                                            ORDER
                                                                                                                                                                                                                                                                                                                                                            BY
                                                                                                                                                                                                                                                                                                                                                            created_at
                                                                                                                                                                                                                                                                                                                                                            DESC
                                                                                                                                                                                                                                                                                                                                                            `;

                                                                                                                                                                                                                                                                                                                                                            return
                                                                                                                                                                                                                                                                                                                                                            db.prepare(sql).all();
                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                            async
                                                                                                                                                                                                                                                                                                                                                            function
                                                                                                                                                                                                                                                                                                                                                            create
                                                                                                                                                                                                                                                                                                                                                            <%= pascalCase(entity.name)
                                                                                                                                                                                                                                                                                                                                                                %>
                                                                                                                                                                                                                                                                                                                                                                (data)
                                                                                                                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                                                                                                                const
                                                                                                                                                                                                                                                                                                                                                                id
                                                                                                                                                                                                                                                                                                                                                                =
                                                                                                                                                                                                                                                                                                                                                                require('uuid').v4();
                                                                                                                                                                                                                                                                                                                                                                const
                                                                                                                                                                                                                                                                                                                                                                now
                                                                                                                                                                                                                                                                                                                                                                =
                                                                                                                                                                                                                                                                                                                                                                new
                                                                                                                                                                                                                                                                                                                                                                Date().toISOString();

                                                                                                                                                                                                                                                                                                                                                                const
                                                                                                                                                                                                                                                                                                                                                                fields
                                                                                                                                                                                                                                                                                                                                                                =
                                                                                                                                                                                                                                                                                                                                                                Object.keys(data).join(',
                                                                                                                                                                                                                                                                                                                                                                ');
                                                                                                                                                                                                                                                                                                                                                                const
                                                                                                                                                                                                                                                                                                                                                                placeholders
                                                                                                                                                                                                                                                                                                                                                                =
                                                                                                                                                                                                                                                                                                                                                                Object.keys(data).map(()
                                                                                                                                                                                                                                                                                                                                                                =>
                                                                                                                                                                                                                                                                                                                                                                '?').join(',
                                                                                                                                                                                                                                                                                                                                                                ');
                                                                                                                                                                                                                                                                                                                                                                const
                                                                                                                                                                                                                                                                                                                                                                values
                                                                                                                                                                                                                                                                                                                                                                =
                                                                                                                                                                                                                                                                                                                                                                Object.values(data);

                                                                                                                                                                                                                                                                                                                                                                const
                                                                                                                                                                                                                                                                                                                                                                sql
                                                                                                                                                                                                                                                                                                                                                                =
                                                                                                                                                                                                                                                                                                                                                                `
                                                                                                                                                                                                                                                                                                                                                                INSERT
                                                                                                                                                                                                                                                                                                                                                                INTO
                                                                                                                                                                                                                                                                                                                                                                <%= pluralize(kebabCase(entity.name))
                                                                                                                                                                                                                                                                                                                                                                    %>
                                                                                                                                                                                                                                                                                                                                                                    (id,
                                                                                                                                                                                                                                                                                                                                                                    ${fields},
                                                                                                                                                                                                                                                                                                                                                                    created_at,
                                                                                                                                                                                                                                                                                                                                                                    updated_at)
                                                                                                                                                                                                                                                                                                                                                                    VALUES
                                                                                                                                                                                                                                                                                                                                                                    (?,
                                                                                                                                                                                                                                                                                                                                                                    ${placeholders},
                                                                                                                                                                                                                                                                                                                                                                    ?,
                                                                                                                                                                                                                                                                                                                                                                    ?)
                                                                                                                                                                                                                                                                                                                                                                    `;

                                                                                                                                                                                                                                                                                                                                                                    db.prepare(sql).run(id,
                                                                                                                                                                                                                                                                                                                                                                    ...values,
                                                                                                                                                                                                                                                                                                                                                                    now,
                                                                                                                                                                                                                                                                                                                                                                    now);

                                                                                                                                                                                                                                                                                                                                                                    return
                                                                                                                                                                                                                                                                                                                                                                    get
                                                                                                                                                                                                                                                                                                                                                                    <%= pascalCase(entity.name)
                                                                                                                                                                                                                                                                                                                                                                        %>
                                                                                                                                                                                                                                                                                                                                                                        ById(id);
                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                        async
                                                                                                                                                                                                                                                                                                                                                                        function
                                                                                                                                                                                                                                                                                                                                                                        update
                                                                                                                                                                                                                                                                                                                                                                        <%= pascalCase(entity.name)
                                                                                                                                                                                                                                                                                                                                                                            %>
                                                                                                                                                                                                                                                                                                                                                                            (data)
                                                                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                                                            const
                                                                                                                                                                                                                                                                                                                                                                            now
                                                                                                                                                                                                                                                                                                                                                                            =
                                                                                                                                                                                                                                                                                                                                                                            new
                                                                                                                                                                                                                                                                                                                                                                            Date().toISOString();
                                                                                                                                                                                                                                                                                                                                                                            const
                                                                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                                                            id,
                                                                                                                                                                                                                                                                                                                                                                            ...updateData
                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                            =
                                                                                                                                                                                                                                                                                                                                                                            data;

                                                                                                                                                                                                                                                                                                                                                                            const
                                                                                                                                                                                                                                                                                                                                                                            fields
                                                                                                                                                                                                                                                                                                                                                                            =
                                                                                                                                                                                                                                                                                                                                                                            Object.keys(updateData).map(key
                                                                                                                                                                                                                                                                                                                                                                            =>
                                                                                                                                                                                                                                                                                                                                                                            `${key}
                                                                                                                                                                                                                                                                                                                                                                            =
                                                                                                                                                                                                                                                                                                                                                                            ?`).join(',
                                                                                                                                                                                                                                                                                                                                                                            ');
                                                                                                                                                                                                                                                                                                                                                                            const
                                                                                                                                                                                                                                                                                                                                                                            values
                                                                                                                                                                                                                                                                                                                                                                            =
                                                                                                                                                                                                                                                                                                                                                                            Object.values(updateData);

                                                                                                                                                                                                                                                                                                                                                                            const
                                                                                                                                                                                                                                                                                                                                                                            sql
                                                                                                                                                                                                                                                                                                                                                                            =
                                                                                                                                                                                                                                                                                                                                                                            `
                                                                                                                                                                                                                                                                                                                                                                            UPDATE
                                                                                                                                                                                                                                                                                                                                                                            <%= pluralize(kebabCase(entity.name))
                                                                                                                                                                                                                                                                                                                                                                                %>
                                                                                                                                                                                                                                                                                                                                                                                SET
                                                                                                                                                                                                                                                                                                                                                                                ${fields},
                                                                                                                                                                                                                                                                                                                                                                                updated_at
                                                                                                                                                                                                                                                                                                                                                                                =
                                                                                                                                                                                                                                                                                                                                                                                ?
                                                                                                                                                                                                                                                                                                                                                                                WHERE
                                                                                                                                                                                                                                                                                                                                                                                id
                                                                                                                                                                                                                                                                                                                                                                                =
                                                                                                                                                                                                                                                                                                                                                                                ?
                                                                                                                                                                                                                                                                                                                                                                                `;

                                                                                                                                                                                                                                                                                                                                                                                db.prepare(sql).run(...values,
                                                                                                                                                                                                                                                                                                                                                                                now,
                                                                                                                                                                                                                                                                                                                                                                                id);

                                                                                                                                                                                                                                                                                                                                                                                return
                                                                                                                                                                                                                                                                                                                                                                                get
                                                                                                                                                                                                                                                                                                                                                                                <%= pascalCase(entity.name)
                                                                                                                                                                                                                                                                                                                                                                                    %>
                                                                                                                                                                                                                                                                                                                                                                                    ById(id);
                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                    async
                                                                                                                                                                                                                                                                                                                                                                                    function
                                                                                                                                                                                                                                                                                                                                                                                    delete
                                                                                                                                                                                                                                                                                                                                                                                    <%= pascalCase(entity.name)
                                                                                                                                                                                                                                                                                                                                                                                        %>
                                                                                                                                                                                                                                                                                                                                                                                        (id)
                                                                                                                                                                                                                                                                                                                                                                                        {
                                                                                                                                                                                                                                                                                                                                                                                        const
                                                                                                                                                                                                                                                                                                                                                                                        sql
                                                                                                                                                                                                                                                                                                                                                                                        =
                                                                                                                                                                                                                                                                                                                                                                                        `DELETE
                                                                                                                                                                                                                                                                                                                                                                                        FROM
                                                                                                                                                                                                                                                                                                                                                                                        <%= pluralize(kebabCase(entity.name))
                                                                                                                                                                                                                                                                                                                                                                                            %>
                                                                                                                                                                                                                                                                                                                                                                                            WHERE
                                                                                                                                                                                                                                                                                                                                                                                            id
                                                                                                                                                                                                                                                                                                                                                                                            =
                                                                                                                                                                                                                                                                                                                                                                                            ?`;
                                                                                                                                                                                                                                                                                                                                                                                            db.prepare(sql).run(id);
                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                            async
                                                                                                                                                                                                                                                                                                                                                                                            function
                                                                                                                                                                                                                                                                                                                                                                                            get
                                                                                                                                                                                                                                                                                                                                                                                            <%= pascalCase(entity.name)
                                                                                                                                                                                                                                                                                                                                                                                                %>
                                                                                                                                                                                                                                                                                                                                                                                                ById(id)
                                                                                                                                                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                                                                                                                                                const
                                                                                                                                                                                                                                                                                                                                                                                                sql
                                                                                                                                                                                                                                                                                                                                                                                                =
                                                                                                                                                                                                                                                                                                                                                                                                `SELECT
                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                FROM
                                                                                                                                                                                                                                                                                                                                                                                                <%= pluralize(kebabCase(entity.name))
                                                                                                                                                                                                                                                                                                                                                                                                    %>
                                                                                                                                                                                                                                                                                                                                                                                                    WHERE
                                                                                                                                                                                                                                                                                                                                                                                                    id
                                                                                                                                                                                                                                                                                                                                                                                                    =
                                                                                                                                                                                                                                                                                                                                                                                                    ?`;
                                                                                                                                                                                                                                                                                                                                                                                                    return
                                                                                                                                                                                                                                                                                                                                                                                                    db.prepare(sql).get(id);
                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                    <% });
                                                                                                                                                                                                                                                                                                                                                                                                        %>
                                                                                                                                                                                                                                                                                                                                                                                                        <% } else
                                                                                                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                                                                                            %>
                                                                                                                                                                                                                                                                                                                                                                                                            //
                                                                                                                                                                                                                                                                                                                                                                                                            Basic
                                                                                                                                                                                                                                                                                                                                                                                                            database
                                                                                                                                                                                                                                                                                                                                                                                                            functions
                                                                                                                                                                                                                                                                                                                                                                                                            for
                                                                                                                                                                                                                                                                                                                                                                                                            pages
                                                                                                                                                                                                                                                                                                                                                                                                            without
                                                                                                                                                                                                                                                                                                                                                                                                            entities
                                                                                                                                                                                                                                                                                                                                                                                                            async
                                                                                                                                                                                                                                                                                                                                                                                                            function
                                                                                                                                                                                                                                                                                                                                                                                                            getItemList(query
                                                                                                                                                                                                                                                                                                                                                                                                            =
                                                                                                                                                                                                                                                                                                                                                                                                            {})
                                                                                                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                                                                                            //
                                                                                                                                                                                                                                                                                                                                                                                                            Return
                                                                                                                                                                                                                                                                                                                                                                                                            empty
                                                                                                                                                                                                                                                                                                                                                                                                            array
                                                                                                                                                                                                                                                                                                                                                                                                            for
                                                                                                                                                                                                                                                                                                                                                                                                            pages
                                                                                                                                                                                                                                                                                                                                                                                                            without
                                                                                                                                                                                                                                                                                                                                                                                                            entities
                                                                                                                                                                                                                                                                                                                                                                                                            return
                                                                                                                                                                                                                                                                                                                                                                                                            [];
                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                            async
                                                                                                                                                                                                                                                                                                                                                                                                            function
                                                                                                                                                                                                                                                                                                                                                                                                            createItem(data)
                                                                                                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                                                                                            const
                                                                                                                                                                                                                                                                                                                                                                                                            id
                                                                                                                                                                                                                                                                                                                                                                                                            =
                                                                                                                                                                                                                                                                                                                                                                                                            require('uuid').v4();
                                                                                                                                                                                                                                                                                                                                                                                                            const
                                                                                                                                                                                                                                                                                                                                                                                                            now
                                                                                                                                                                                                                                                                                                                                                                                                            =
                                                                                                                                                                                                                                                                                                                                                                                                            new
                                                                                                                                                                                                                                                                                                                                                                                                            Date().toISOString();

                                                                                                                                                                                                                                                                                                                                                                                                            return
                                                                                                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                                                                                            id,
                                                                                                                                                                                                                                                                                                                                                                                                            ...data,
                                                                                                                                                                                                                                                                                                                                                                                                            createdAt:
                                                                                                                                                                                                                                                                                                                                                                                                            now,
                                                                                                                                                                                                                                                                                                                                                                                                            updatedAt:
                                                                                                                                                                                                                                                                                                                                                                                                            now
                                                                                                                                                                                                                                                                                                                                                                                                            };
                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                            async
                                                                                                                                                                                                                                                                                                                                                                                                            function
                                                                                                                                                                                                                                                                                                                                                                                                            updateItem(data)
                                                                                                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                                                                                            const
                                                                                                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                                                                                            id,
                                                                                                                                                                                                                                                                                                                                                                                                            ...updateData
                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                            =
                                                                                                                                                                                                                                                                                                                                                                                                            data;
                                                                                                                                                                                                                                                                                                                                                                                                            const
                                                                                                                                                                                                                                                                                                                                                                                                            now
                                                                                                                                                                                                                                                                                                                                                                                                            =
                                                                                                                                                                                                                                                                                                                                                                                                            new
                                                                                                                                                                                                                                                                                                                                                                                                            Date().toISOString();

                                                                                                                                                                                                                                                                                                                                                                                                            return
                                                                                                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                                                                                            id,
                                                                                                                                                                                                                                                                                                                                                                                                            ...updateData,
                                                                                                                                                                                                                                                                                                                                                                                                            updatedAt:
                                                                                                                                                                                                                                                                                                                                                                                                            now
                                                                                                                                                                                                                                                                                                                                                                                                            };
                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                            async
                                                                                                                                                                                                                                                                                                                                                                                                            function
                                                                                                                                                                                                                                                                                                                                                                                                            deleteItem(id)
                                                                                                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                                                                                            //
                                                                                                                                                                                                                                                                                                                                                                                                            No-op
                                                                                                                                                                                                                                                                                                                                                                                                            for
                                                                                                                                                                                                                                                                                                                                                                                                            pages
                                                                                                                                                                                                                                                                                                                                                                                                            without
                                                                                                                                                                                                                                                                                                                                                                                                            entities
                                                                                                                                                                                                                                                                                                                                                                                                            return
                                                                                                                                                                                                                                                                                                                                                                                                            true;
                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                            async
                                                                                                                                                                                                                                                                                                                                                                                                            function
                                                                                                                                                                                                                                                                                                                                                                                                            getItemById(id)
                                                                                                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                                                                                            return
                                                                                                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                                                                                            id,
                                                                                                                                                                                                                                                                                                                                                                                                            createdAt:
                                                                                                                                                                                                                                                                                                                                                                                                            new
                                                                                                                                                                                                                                                                                                                                                                                                            Date().toISOString(),
                                                                                                                                                                                                                                                                                                                                                                                                            updatedAt:
                                                                                                                                                                                                                                                                                                                                                                                                            new
                                                                                                                                                                                                                                                                                                                                                                                                            Date().toISOString()
                                                                                                                                                                                                                                                                                                                                                                                                            };
                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                            <% }
                                                                                                                                                                                                                                                                                                                                                                                                                %>

                                                                                                                                                                                                                                                                                                                                                                                                                module.exports
                                                                                                                                                                                                                                                                                                                                                                                                                =
                                                                                                                                                                                                                                                                                                                                                                                                                router;